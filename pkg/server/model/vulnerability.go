package model

import (
	"github.com/caicloud/cyclone/pkg/server/apis/v1alpha1"
	mgo "gopkg.in/mgo.v2"
	"gopkg.in/mgo.v2/bson"
)

// Vulnerability ...
var Vulnerability *VulnerabilityInfo

// VulnerabilityInfo ...
type VulnerabilityInfo struct {
	*mgo.Collection
}

// Save save record
func (v *VulnerabilityInfo) Save(record *v1alpha1.ImageScanRecord) error {
	return v.Insert(record)
}

// Retrieve retrieve record
func (v *VulnerabilityInfo) Retrieve(workflowRun string) ([]v1alpha1.Vulnerability, error) {
	record := v1alpha1.ImageScanRecord{}
	err := v.Find(bson.M{
		"workflow_run": workflowRun,
	}).One(&record)

	return record.Vulnerabilities, err
}

// Delete delete record
func (v *VulnerabilityInfo) Delete(workflowRun string) error {
	err := v.Remove(bson.M{
		"workflow_run": workflowRun,
	})

	return err
}
